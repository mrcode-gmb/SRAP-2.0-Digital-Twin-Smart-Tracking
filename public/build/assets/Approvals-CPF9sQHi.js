import{j as e}from"./ui--EPVQjIL.js";import{R as s,r as a,H as r}from"./inertia-Cj_WjKpf.js";import{A as t,B as l,T as i,C as d}from"./AuthenticatedLayout-rIECtlsZ.js";import{u as n,C as o,b as c}from"./app-mKMKGM5i.js";import{C as m,a as x,b as p,c as h,d as g}from"./Card-BDwu8o3f.js";import{c as j,B as u}from"./Button-DAnlAX8y.js";import{C as b}from"./clock-C9IOtF09.js";import{T as f,U as N,D as v}from"./users-h2zC9xgO.js";import{m as y}from"./motion-CwjCYErC.js";import{D as w}from"./download-Bq8EvEAx.js";import"./vendor-vi784Xxu.js";import"./utils-54zDqgmH.js";import"./house-V8upMmDd.js";const k=s.forwardRef(({className:s,...a},r)=>e.jsx("textarea",{className:j("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...a}));function C({auth:s,pendingApprovals:j=[],department:C,stats:S}){const{showSuccess:D,showError:P}=n(),[_,A]=a.useState(j),[R,T]=a.useState(!1),[F,E]=a.useState(""),[O,z]=a.useState(null);a.useEffect(()=>{A(j)},[j]);const U=e=>{const s={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",completed:"bg-green-100 text-green-800 border-green-200",rejected:"bg-red-100 text-red-800 border-red-200",processing:"bg-blue-100 text-blue-800 border-blue-200",failed:"bg-red-100 text-red-800 border-red-200"};return s[e]||s.pending};return e.jsxs(t,{user:s.user,children:[e.jsx(r,{title:"Pending Approvals - HOD Dashboard"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:["Pending Approvals - ",S?.department_name||"Department"]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Review and approve data uploads from your department (",S?.total_pending||0," pending)"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(l,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),_.length," Pending"]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(b,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Pending Approval"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:_.length})]})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(o,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Approved Today"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"0"})]})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(f,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Department KPIs"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"-"})]})]})})})]}),e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsxs(h,{className:"flex items-center",children:[e.jsx(i,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Submissions Requiring Approval"]}),e.jsx(g,{children:"Review KPI progress data submitted by Data Officers. Download files to review content before approval."})]}),e.jsx(x,{children:R?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Loading pending approvals..."})]}):0===_.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(o,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Pending Approvals"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"All submissions have been reviewed. Great work!"})]}):e.jsx("div",{className:"space-y-4",children:_.map(s=>e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white",children:s.original_filename||"Data Upload"}),e.jsx(l,{className:U(s.status),children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),s.uploader?.name||"Unknown"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),new Date(s.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{className:"w-4 h-4 mr-1"}),"Records: ",s.records_processed||0]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),s.file_type," (",s.file_size_human||"Unknown size",")"]})]}),s.errors_count>0&&e.jsxs("div",{className:"mt-2 p-2 bg-yellow-100 dark:bg-yellow-900/20 rounded text-sm",children:[e.jsx("strong",{children:"Errors:"})," ",s.errors_count," errors found during processing"]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsxs(u,{onClick:()=>((e,s)=>{try{const a=document.createElement("a");a.href=`/admin/progress-upload/${e}/download`,a.download=s,document.body.appendChild(a),a.click(),document.body.removeChild(a),D("File download started")}catch(a){P("Failed to download file")}})(s.id,s.original_filename),variant:"outline",className:"border-blue-300 text-blue-600 hover:bg-blue-50",size:"sm",title:"Download file for review",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),"Download"]}),e.jsxs(u,{onClick:()=>(async e=>{try{const s=await fetch(`/admin/progress-upload/${e}/approve`,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,"Content-Type":"application/json"}}),a=await s.json();s.ok?(D(a.message||"Upload approved successfully"),A(s=>s.filter(s=>s.id!==e))):P(a.error||"Failed to approve upload")}catch(s){P("Failed to approve entry")}})(s.id),className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(u,{onClick:()=>z(s),variant:"outline",className:"border-red-300 text-red-600 hover:bg-red-50",size:"sm",children:[e.jsx(c,{className:"w-4 h-4 mr-1"}),"Reject"]})]})]})},s.id))})})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Reject Submission"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Please provide a reason for rejecting this KPI progress submission:"}),e.jsx(k,{value:F,onChange:e=>E(e.target.value),placeholder:"Enter rejection reason...",className:"mb-4",rows:3}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(u,{onClick:()=>(async e=>{if(F.trim())try{const s=await fetch(`/admin/progress-upload/${e}/reject`,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,"Content-Type":"application/json"},body:JSON.stringify({rejection_reason:F})}),a=await s.json();s.ok?(D(a.message||"Upload rejected successfully"),A(e=>e.filter(e=>e.id!==O.id)),z(null),E("")):P(a.error||"Failed to reject upload")}catch(s){P("Failed to reject upload")}else P("Please provide a rejection reason")})(O.id),className:"bg-red-600 hover:bg-red-700 text-white flex-1",children:"Reject"}),e.jsx(u,{onClick:()=>{z(null),E("")},variant:"outline",className:"flex-1",children:"Cancel"})]})]})})]})})]})}k.displayName="Textarea";export{C as default};
