import{j as e}from"./ui--EPVQjIL.js";import{u as s,r as t,H as a,L as r}from"./inertia-Cj_WjKpf.js";import{A as n,M as i,B as l}from"./AuthenticatedLayout-rIECtlsZ.js";import{C as c,b as o,c as m,a as d,d as x}from"./Card-BDwu8o3f.js";import{B as u}from"./Button-DAnlAX8y.js";import{B as h}from"./bot-MFdLP4o-.js";import{C as p}from"./app-mKMKGM5i.js";import{S as g}from"./sparkles-Cx5KwcHB.js";import{U as j}from"./users-h2zC9xgO.js";import{C as f}from"./clock-C9IOtF09.js";import{S as y}from"./send-B8Kbx5Wi.js";import{A as N}from"./arrow-left-Ch62iP75.js";import"./vendor-vi784Xxu.js";import"./utils-54zDqgmH.js";import"./house-V8upMmDd.js";import"./motion-CwjCYErC.js";function b({auth:b,userConversations:w}){const{props:v}=s(),[C,S]=t.useState(""),[k,D]=t.useState([]),[_,T]=t.useState(!1),[A,P]=t.useState(null),[L,B]=t.useState(null),I=e=>{S(e)};return e.jsxs(n,{user:b.user,header:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(r,{href:route("admin.chatbot.index"),className:"flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Back to Conversations"]}),e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"New Chatbot Conversation"})]})}),children:[e.jsx(a,{title:"New Chatbot Conversation"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(c,{className:"h-[600px] flex flex-col",children:[e.jsxs(o,{children:[e.jsx(m,{className:"text-lg",children:"Your Conversations"}),e.jsxs(u,{onClick:()=>{D([]),P(null),B(null)},className:"w-full mt-2",variant:L?"outline":"default",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"New Chat"]})]}),e.jsx(d,{className:"flex-1 overflow-y-auto p-4",children:e.jsxs("div",{className:"space-y-2",children:[w?.map(s=>e.jsxs("button",{onClick:()=>(async e=>{try{const s=await fetch(route("admin.chatbot.history",e));if(s.ok){const t=(await s.json()).map(e=>[{id:`user-${e.id}`,message:e.user_message,type:"user",timestamp:new Date(e.created_at)},{id:`bot-${e.id}`,message:e.bot_response,type:"bot",timestamp:new Date(e.created_at),intent:e.intent,confidence:e.confidence_score}]).flat();D(t),P(e),B(e)}}catch(s){}})(s.session_id),className:"w-full text-left p-3 rounded-lg border transition-colors "+(L===s.session_id?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200 hover:bg-gray-100"),children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:[s.last_message?.substring(0,30),"..."]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.message_count," messages â€¢ ",new Date(s.created_at).toLocaleDateString()]})]},s.session_id)),(!w||0===w.length)&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(i,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No conversations yet"})]})]})})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(c,{className:"h-[600px] flex flex-col",children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-blue-100 rounded-full",children:e.jsx(h,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs(m,{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"SRAP 2.0 Digital Twin Assistant"}),e.jsxs(l,{variant:"secondary",className:"bg-green-100 text-green-800",children:[e.jsx(p,{className:"w-3 h-3 mr-1"}),"Online"]})]}),e.jsx(x,{children:"Ask me about KPIs, milestones, reports, and more"})]})]})}),e.jsxs(d,{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 mb-4 pr-2",children:[0===k.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(g,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Start a conversation"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"I can help you with KPI management, milestone tracking, report generation, and more."}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:["Show KPI dashboard","Generate progress report","Check milestone status","View recent alerts"].map(s=>e.jsx(u,{variant:"outline",size:"sm",onClick:()=>I(s),className:"text-sm",children:s},s))})]}),k.map(s=>{return e.jsx("div",{className:"flex "+("user"===s.type?"justify-end":"justify-start"),children:e.jsxs("div",{className:"flex space-x-3 max-w-[80%] "+("user"===s.type?"flex-row-reverse space-x-reverse":""),children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full flex-shrink-0 "+("user"===s.type?"bg-blue-600":s.error?"bg-red-100":"bg-gray-100"),children:"user"===s.type?e.jsx(j,{className:"w-4 h-4 text-white"}):e.jsx(h,{className:"w-4 h-4 "+(s.error?"text-red-600":"text-gray-600")})}),e.jsxs("div",{className:"rounded-lg p-3 "+("user"===s.type?"bg-blue-600 text-white":s.error?"bg-red-50 text-red-800 border border-red-200":"bg-gray-100 text-gray-900"),children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.message}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-xs "+("user"===s.type?"text-blue-100":"text-gray-500"),children:[e.jsx(f,{className:"w-3 h-3 inline mr-1"}),(t=s.timestamp,new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))]}),s.confidence&&e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(100*s.confidence),"% confidence"]})]}),s.suggestions&&s.suggestions.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:s.suggestions.map((s,t)=>e.jsx(u,{variant:"outline",size:"sm",onClick:()=>I(s),className:"text-xs h-7",children:s},t))})]})]})},s.id);var t}),_&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"flex space-x-3 max-w-[80%]",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 rounded-full",children:e.jsx(h,{className:"w-4 h-4 text-gray-600"})}),e.jsx("div",{className:"bg-gray-100 rounded-lg p-3",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!C.trim()||_)return;const s=C.trim();S(""),T(!0);const t={id:Date.now(),message:s,type:"user",timestamp:new Date};D(e=>[...e,t]);const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||v.csrf_token||window.Laravel?.csrfToken;if(!a)throw new Error("CSRF token not found");try{const e=await fetch(route("admin.chatbot.message"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({message:s,session_id:A}),credentials:"same-origin"});if(npm,!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();!A&&t.session_id&&P(t.session_id);const r={id:Date.now()+1,message:t.message,type:"bot",timestamp:new Date,intent:t.intent,confidence:t.confidence,suggestions:t.suggestions||[]};D(e=>[...e,r])}catch(r){const e={id:Date.now()+1,message:"Sorry, I encountered an error. Please try again.",type:"bot",timestamp:new Date,error:!0};D(s=>[...s,e])}finally{T(!1)}},className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:C,onChange:e=>S(e.target.value),placeholder:"Type your message...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:_}),e.jsx(u,{type:"submit",disabled:!C.trim()||_,className:"px-4 py-2",children:e.jsx(y,{className:"w-4 h-4"})})]})]})]})})]})})})]})}export{b as default};
